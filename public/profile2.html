<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Admin Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600&family=Fredoka+One&display=swap"
    rel="stylesheet" />
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background-color: #ffe6f3;
      margin: 0;
      color: #d23481;
      user-select: none;
    }

    .container {
      display: flex;
      min-height: 100vh;
    }

    .sidebar {
      width: 80px;
      border-right: 2px solid #d23481;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 1rem 0;
      gap: 2rem;
      background-color: #ffe6f3;
      border-radius: 0 16px 16px 0;
    }

    .logo {
      margin-bottom: 1rem;
    }

    .logo img {
      width: 36px;
      height: 36px;
    }

    .left-buttons {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 3rem;
      width: 100%;
    }

    .left-buttons button {
      background: none;
      border: none;
      color: #d23481;
      cursor: pointer;
      font-weight: 600;
      font-size: 0.85rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.3rem;
      padding: 0.2rem 0;
      transition: color 0.3s;
    }

    .left-buttons button:hover {
      color: #0e0107;
    }

    .left-buttons button.active {
      color: #ea5a9f;
      font-weight: 700;
    }

    .left-buttons button img {
      width: 24px;
      height: 24px;
    }

    .main-content {
      flex-grow: 1;
      padding: 1.5rem 2rem;
      display: flex;
      flex-direction: column;
    }

    .topbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 1.5rem;
    }

    .topbar h1 {
      font-family: 'Fredoka One', cursive;
      font-size: 40px;
      font-weight: 900;
      color: #d23481;
      margin: 0;
      letter-spacing: -1px;
    }

    .right-buttons {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .right-buttons button {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-weight: 600;
      font-size: 1rem;
      border-radius: 12px;
      padding: 0.5rem 1rem;
      cursor: pointer;
      border: 2px solid #d23481;
      background-color: #fff;
      color: #d23481;
      transition: background-color 0.3s, color 0.3s;
    }

    .right-buttons button img {
      width: 28px;
      height: 28px;
    }

    .right-buttons button:hover,
    .admin-btn {
      background-color: #d23481;
      color: #fff;
      border: 2px solid #d23481;
    }

    .subnav {
      display: flex;
      border-bottom: 2px solid #d23481;
      margin-bottom: 1.5rem;
      gap: 2rem;
      font-size: 0.93rem;
    }

    .subnav button {
      background: none;
      border: none;
      cursor: pointer;
      padding-bottom: 0.5rem;
      color: #d23481;
      border-bottom: 3px solid transparent;
    }

    .subnav button.active {
      border-bottom: 3px solid #d23481;
      font-weight: 700;
    }

    h1.greeting {
      text-align: center;
      font-weight: bold;
      font-size: 80px;
      color: #c32d6c;
      margin-left: 60px;
      margin-top: 60px;
      margin-bottom: -50px;
      user-select: none;
    }

    .profile-info {
      display: flex;
      align-items: center;
      gap: 1.2rem;
      padding: 1.2rem;
      background: transparent;
      border-radius: 12px;
      width: auto;
      margin-left: auto;
      margin-right: 0;
    }

    .profile-img {
      width: 72px;
      height: 72px;
      background-size: cover;
      background-position: center;
      border-radius: 50%;
      border: 2px solid #d3d3d3;
      color: #d23481;
    }

    .profile-bio {
      display: flex;
      flex-direction: column;
      justify-content: center;
    }

    .profile-bio strong {
      font-size: 1.4rem;
      font-weight: bold;
      color: #333;
    }

    #profile-bio-text {
      font-size: 1rem;
      line-height: 1.3;
      color: #555;
    }

    .btn-edit-profile {
      margin-left: auto;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.55rem 1rem;
      background: #f4efe6;
      color: #222;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1rem;
      font-weight: 600;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
      transition: 0.25s ease;
    }

    .btn-edit-profile img {
      width: 22px;
      height: 22px;
    }

    .btn-edit-profile:hover {
      background: #e61c89;
      color: #fff;
    }

    @media (max-width: 600px) {

      .profile-info {
        flex-direction: column;
        text-align: center;
        gap: 1rem;
        margin-left: 0;
      }

      .btn-edit-profile {
        width: 100%;
        justify-content: center;
      }
    }

    /* Edit Profile Modal Background */
    #edit-profile-modal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(6px);
      z-index: 10000;
      align-items: center;
      justify-content: center;
      padding: 16px;
      user-select: none;
    }

    /* Show modal when active */
    #edit-profile-modal.active {
      display: flex;
    }

    /* Modal box - CORRECTED SIZE */
    .edit-profile-modal {
      background: linear-gradient(135deg, #fff6fc, #ffe3f0);
      border-radius: 16px;
      width: 400px; /* Fixed width */
      max-width: 90vw; /* Responsive on small screens */
      padding: 24px 28px 28px 28px;
      position: relative;
      display: flex;
      flex-direction: column;
      gap: 14px;
      user-select: none;
      font-family: 'Poppins', sans-serif;
      box-shadow: 0 8px 30px rgba(211, 35, 129, 0.3);
    }

    /* Close button */
    #edit-profile-close {
      position: absolute;
      top: 8px;
      right: 12px;
      background: transparent;
      border: none;
      font-size: 26px;
      font-weight: 700;
      color: #d23481;
      cursor: pointer;
      user-select: none;
      transition: color 0.3s;
    }
    #edit-profile-close:hover {
      color: #a4154f;
    }

    /* Profile pic section centered */
    .profile-pic-section {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
      user-select: none;
    }

    .profile-pic-placeholder {
      width: 90px;
      height: 90px;
      border-radius: 50%;
      overflow: hidden;
      border: 3px solid #d23481;
      box-shadow: 0 8px 30px rgba(211, 35, 129, 0.15);
    }

    .profile-pic-placeholder img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 50%;
    }

    /* Change button */
    #change-photo-btn {
      background-color: #ffd0dc;
      border: 1px solid #db7093;
      border-radius: 8px;
      padding: 6px 14px;
      color: #bf2e68;
      font-weight: 600;
      letter-spacing: 0.6px;
      cursor: pointer;
      transition: background-color 0.25s;
      user-select: none;
      font-size: 0.9rem;
      min-width: 90px;
      text-align: center;
    }
    #change-photo-btn:hover {
      background-color: #bf2e68;
      color: #fff;
    }

    /* Form styling */
    #edit-profile-form {
      display: flex;
      flex-direction: column;
      gap: 10px;
      user-select: text;
    }

    #edit-profile-form label {
      font-weight: 600;
      color: #a4154f;
      font-size: 0.8rem;
      margin-left: 4px;
      user-select: none;
    }

    #edit-profile-form input[type="text"],
    #edit-profile-form textarea {
      border: 1.8px solid #fbc9d9;
      border-radius: 10px;
      padding: 8px 14px;
      font-size: 1rem;
      font-family: 'Poppins', sans-serif;
      color: #d23481;
      resize: vertical;
      transition: border-color 0.3s;
      min-height: 40px;
      box-sizing: border-box;
      width: 100%;
    }

    #edit-profile-form textarea {
      min-height: 60px;
    }

    #edit-profile-form input[type="text"]:focus,
    #edit-profile-form textarea:focus {
      border-color: #d23481;
      outline: none;
    }

    /* Buttons container */
    .edit-profile-buttons {
      margin-top: 18px;
      display: flex;
      justify-content: flex-end;
      gap: 10px;
    }

    /* Cancel button */
    #edit-cancel-btn {
      background-color: #b8b8b8;
      color: white;
      border: none;
      padding: 8px 18px;
      border-radius: 10px;
      font-weight: 600;
      cursor: pointer;
      transition: background-color 0.3s;
      user-select: none;
      font-size: 0.95rem;
    }

    #edit-cancel-btn:hover {
      background-color: #999999;
    }

    /* Save button with smooth gradient */
    #edit-save-btn {
      border: none;
      padding: 8px 22px;
      border-radius: 18px;
      font-weight: 700;
      color: white;
      background: linear-gradient(90deg, #ff3c7d 0%, #b2ff5c 100%);
      cursor: pointer;
      user-select: none;
      font-size: 0.95rem;
      transition: background 0.4s;
    }

    #edit-save-btn:hover {
      background: linear-gradient(90deg, #87be20 0%, #ff3c7d 100%);
    }

    /* Photo library grid */
    .photo-library-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 12px 20px;
      margin-top: 12px;
      user-select: none;
      max-width: 100%;
    }

    .photo-card {
      width: 140px;
      border-radius: 12px;
      background-color: #fdca8c;
      box-shadow: none;
      padding: 8px 6px;
      cursor: pointer;
      border: 2px solid transparent;
      display: flex;
      flex-direction: column;
      gap: 8px;
      transition: border-color 0.3s ease;
    }

    .photo-card.even {
      background: #47a851;
      border-color: #2e7c18;
    }

    .photo-card img {
      width: 100%;
      height: 300px;
      object-fit: cover;
      border-radius: 10px;
      user-select: none;
      display: block;
      box-shadow: 0 5px 10px rgb(0 0 0 / 0.05);
      border: 4px solid white;
      transition: border-color 0.2s ease;
    }

    .photo-card:hover,
    .photo-card:focus-visible {
      border-color: #d72b7e;
      outline: none;
    }

    /* Favorites Section */
    #section-favorites {
      user-select: none;
      display: none;
    }
    
    #section-favorites.active {
      display: block;
    }
    
    #section-favorites h2 {
      font-family: 'Fredoka One', cursive;
      font-size: 30px;
      margin-top: 0;
      color: #c32d6c;
    }
    
    .favorites-grid {
      display: grid;
      gap: 14px;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      padding-top: 30px;
    }
    
    .favorite-photo-card {
      border-radius: 10px;
      border: 5px solid #f9d7a8;
      background: #f9d7a8;
      user-select: none;
      cursor: pointer;
    }
    
    .favorite-photo-card img {
      width: 100%;
      height: 300px;
      object-fit: cover;
    }
    
    .favorite-photo-card:focus {
      outline: 2px solid #a31a62;
      outline-offset: 2px;
    }
    
    .no-favorites-msg {
      font-style: italic;
      color: #f9acdb;
      user-select: none;
      text-align: center;
      padding: 20px;
    }

    /* Activity Section */
    #section-activity {
      user-select: none;
      display: none;
    }
    
    #section-activity.active {
      display: block;
    }
    
    #section-activity h2 {
      font-family: 'Fredoka One', cursive;
      font-size: 30px;
      margin-top: 0;
      color: #c32d6c;
    }
    
    .activity-container {
      display: flex;
      flex-direction: column;
      gap: 22px;
      height: 100%;
      overflow-y: auto;
    }
    
    .activity-post {
      background: white;
      border-radius: 14px;
      border: 1px solid #f3c7d9;
      padding: 12px 14px;
      font-size: 14px;
      line-height: 1.3;
      color: #d72b7e;
      white-space: pre-line;
      word-break: break-word;
    }
    
    .activity-post.empty {
      font-style: italic;
      color: #f29dcc;
      border-color: #fddaeb;
    }

    /* Modal styles for single photo view */
    .modal-bg {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(3px);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      padding: 12px;
      user-select: none;
    }

    .modal-bg.active {
      display: flex;
    }

    .modal {
      background: #fef9fb;
      border-radius: 14px;
      width: 760px;
      max-width: 95vw;
      max-height: 90vh;
      display: flex;
      user-select: none;
      box-shadow: 0 8px 30px rgba(211, 35, 129, 0.3);
      overflow: hidden;
    }

    .modal-left {
      width: 180px;
      background: #f9d7e7;
      padding: 12px 8px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      border-top-left-radius: 14px;
      border-bottom-left-radius: 14px;
    }

    .modal-left img {
      width: 140px;
      height: 500px;
      object-fit: cover;
      border-radius: 10px;
      border: 4px solid white;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
      user-select: none;
    }

    .modal-right {
      flex-grow: 1;
      display: flex;
      flex-direction: column;
      padding: 20px 24px 12px 24px;
      box-sizing: border-box;
      overflow-y: auto;
      border-top-right-radius: 14px;
      border-bottom-right-radius: 14px;
      max-height: 600px;
    }

    .modal-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 1px solid #f3c7d9;
      padding-bottom: 10px;
      user-select: none;
    }

    .modal-header .username {
      font-weight: 700;
      color: #d72b7e;
      font-size: 1.2rem;
    }

    .modal-close-btn {
      background: transparent;
      border: none;
      font-size: 26px;
      line-height: 1;
      cursor: pointer;
      color: #d72b7e;
      font-weight: 700;
      transition: color 0.3s ease;
      user-select: none;
    }

    .modal-close-btn:hover {
      color: #a4154f;
    }

    .comments {
      flex-grow: 1;
      overflow-y: auto;
      border-top: 1px solid #f3c7d9;
      border-bottom: 1px solid #f3c7d9;
      margin: 12px 0;
      padding: 10px 0;
      user-select: none;
    }

    .no-comments {
      color: #faaad9;
      font-size: 14px;
      text-align: center;
      margin-top: 40px;
      user-select: none;
    }

    .comment {
      display: flex;
      gap: 10px;
      margin-bottom: 12px;
      outline-offset: 2px;
      user-select: none;
    }

    .comment:focus-visible {
      outline: 2px solid #d72b7e;
      border-radius: 8px;
    }

    .comment .avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: url('https://via.placeholder.com/40x40.png?text=') center/cover no-repeat;
      flex-shrink: 0;
      user-select: none;
    }

    .comment-content {
      flex-grow: 1;
    }

    .comment-author {
      font-weight: 700;
      font-size: 14px;
      color: #d72b7e;
      user-select: none;
    }

    .comment-text {
      font-size: 13px;
      margin-top: 4px;
      color: #444;
      white-space: pre-wrap;
      word-wrap: break-word;
      user-select: text;
    }

    .comment-footer {
      display: flex;
      align-items: center;
      gap: 15px;
      font-size: 11px;
      color: #aaa;
      margin-top: 6px;
      user-select: none;
    }

    .comment-footer button {
      border: none;
      background: none;
      color: #d72b7e;
      font-weight: 700;
      cursor: pointer;
      padding: 0;
      font-size: 12px;
    }

    .comment-footer button:disabled {
      cursor: default;
      color: #f9b4d5;
    }

    /* Updated reaction icons to use images */
    .heart-icon,
    .comment-icon,
    .bookmark-icon {
      cursor: pointer;
      width: 18px;
      height: 18px;
      transition: transform 0.2s ease;
      user-select: none;
      flex-shrink: 0;
    }

    .heart-icon.liked,
    .bookmark-icon.active {
      background-color: #d72b7e;
    }


    .reaction-footer {
      padding-top: 8px;
      font-weight: 700;
      color: #d72b7e;
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .reaction-footer div.likes-text {
      font-weight: 900;
      margin-left: auto;
      color: #a41753;
      user-select: none;
    }

    .comment-form {
      display: flex;
      gap: 12px;
    }

    .comment-form textarea {
      flex-grow: 1;
      border-radius: 10px;
      border: 1px solid #f3c7d9;
      background: #fff0f8;
      padding: 10px 14px;
      font-size: 14px;
      resize: vertical;
      min-height: 48px;
      outline: none;
      color: #d72b7e;
      font-family: inherit;
      user-select: text;
      transition: border-color 0.3s ease;
    }

    .comment-form textarea:focus {
      border-color: #d72b7e;
    }

    .comment-form textarea::placeholder {
      color: #f9c5db;
    }

    .comment-form button {
      border: none;
      background: transparent;
      font-weight: 700;
      font-size: 14px;
      color: #d72b7e;
      cursor: pointer;
      opacity: 0.75;
      user-select: none;
      transition: opacity 0.3s ease;
    }

    .comment-form button:disabled {
      opacity: 0.3;
      cursor: default;
    }

    .comment-form button:hover:not(:disabled) {
      opacity: 1;
    }

    /* Hidden file input */
    #profile-photo-input {
      display: none;
    }
  </style>
</head>

<body>
  <div class="container">
    <nav class="sidebar" aria-label="Sidebar Navigation">
      <div class="logo">
        <img src="Icons/11.svg" alt="Webooth logo" />
      </div>
      <div class="left-buttons">
        <button data-target="templates" aria-label="Templates">
          <img src="Icons 2/templates.svg" alt="Templates icon" />
          <span>Templates</span>
        </button>
        <button data-target="favorites" aria-label="Favorites">
          <img src="Icons 2/favorites.svg" alt="Favorites icon" />
          <span>Favorites</span>
        </button>
        <button data-target="activity" aria-label="Activity">
          <img src="Icons 2/activity.svg" alt="Activity icon" />
          <span>Activity</span>
        </button>
        <button data-target="logout" aria-label="Logout">
          <img src="Icons 2/logout.svg" alt="Logout icon" />
          <span>Logout</span>
        </button>
      </div>
    </nav>
    <main class="main-content" role="main">
      <header class="topbar">
        <h1 class="greeting" aria-live="polite">Hi, <span id="username-display">Username</span>!</h1>
        <div class="right-buttons">
          <button onclick="window.location.href='booth.html'">
            <img src="Icons/2.svg" alt="Booth icon" />
            Booth
          </button>
          <button onclick="window.location.href='profile.html'">
            <img src="Icons/4.svg" alt="Profile icon" />
            Profile
          </button>
        </div>
      </header>

      <!-- Profile info -->
      <section class="profile-info" aria-label="User profile info">
        <div class="profile-img" aria-hidden="true" id="profile-img"
          style="background-image: url('https://via.placeholder.com/72x72.png?text=');"></div>
        <div class="profile-bio">
          <strong id="profile-username">Username</strong>
          <div>
            <span id="profile-bio-text">bio<br>0 photo</span>
          </div>
        </div>
        <button class="btn-edit-profile" id="btn-edit-profile" aria-label="Edit Profile" type="button">
          <img src="Icons 2/edit.svg" alt="Edit icon" />
          Edit Profile
        </button>
      </section>

      <!-- Edit Profile Modal -->
      <div class="modal-bg" id="edit-profile-modal" role="dialog" aria-modal="true" aria-labelledby="edit-profile-title"
        tabindex="-1">
        <div class="modal edit-profile-modal" role="document" aria-labelledby="edit-profile-title" aria-describedby="edit-profile-description">
          <button class="modal-close-btn" id="edit-profile-close" aria-label="Close edit profile modal">&times;</button>
          <div class="edit-profile-content">
            <div class="profile-pic-section" aria-describedby="edit-profile-description">
              <div class="profile-pic-placeholder" aria-hidden="true">
                <img id="edit-profile-pic" src="https://via.placeholder.com/100" alt="Profile Picture" />
              </div>
              <button id="change-photo-btn" type="button" aria-label="Change Profile Photo">Change</button>
              <input type="file" id="profile-photo-input" accept="image/*" style="display:none" />
            </div>
            <form id="edit-profile-form" novalidate>
              <label for="edit-username">Username</label>
              <input id="edit-username" name="username" type="text" autocomplete="username" required />
              <label for="edit-bio">Bio</label>
              <textarea id="edit-bio" name="bio" rows="3"></textarea>
              <div class="edit-profile-buttons">
                <button type="button" id="edit-cancel-btn">Cancel</button>
                <button type="submit" id="edit-save-btn">Save Changes</button>
              </div>
            </form>
          </div>
        </div>
      </div>

      <div class="subnav" role="tablist" aria-label="Main Content Tabs">
        <button role="tab" aria-selected="true" class="active" id="tab-photolib-btn">Photo Library</button>
      </div>

      <section id="tab-photolib" role="tabpanel" aria-labelledby="tab-photolib-btn" class="section">
        <div class="photo-library-grid" aria-live="polite" aria-label="Photo Library Grid"></div>
      </section>

      <!-- Favorites Section -->
      <section id="section-favorites" class="section" role="region" aria-label="Favorites Section">
        <h2>Favorites</h2>
        <div class="favorites-grid" aria-live="polite"></div>
      </section>

      <!-- Activity Section -->
      <section id="section-activity" class="section" role="region" aria-label="Activity Log Section">
        <h2>Activity</h2>
        <div class="activity-container" aria-live="polite"></div>
      </section>
    </main>
  </div>

  <!-- Modal for Post + comments -->
  <div class="modal-bg" id="post-modal" role="dialog" aria-modal="true" aria-labelledby="modal-username" tabindex="-1">
    <div class="modal">
      <div class="modal-left" aria-label="Selected photo">
        <!-- Single photo will be placed here -->
      </div>
      <div class="modal-right">
        <div class="modal-header">
          <div class="username" id="modal-username"></div>
          <button class="modal-close-btn" id="post-modal-close-btn" aria-label="Close modal">&times;</button>
        </div>
        <div id="comments-container" class="comments"></div>
        <div id="no-comments-text" class="no-comments" style="display:none;">No comments yet.</div>
        <form id="comment-form" class="comment-form">
          <textarea id="comment-input" placeholder="Add a comment..." rows="2" aria-label="Add a comment"></textarea>
          <button id="comment-post-btn" type="submit" disabled>Post</button>
        </form>
        <div id="reaction-footer" class="reaction-footer"></div>
      </div>
    </div>
  </div>

  <script>
    const state = {
      user: {
        username: 'Username',
        bio: 'bio',
        photoCount: 0,
        profileImg: 'https://via.placeholder.com/72x72.png?text='
      },
      photos: [
        {
          id: 1,
          src: 'https://via.placeholder.com/720x480?text=Photo+1',
          liked: false,
          favorite: false,
          date: 'October 29',
          comments: []
        },
        {
          id: 2,
          src: 'https://via.placeholder.com/720x480?text=Photo+2',
          liked: false,
          favorite: false,
          date: 'October 30',
          comments: []
        },
       
      ],
      activities: []
    };

    // Update user UI (profile and greeting)
    function updateUserUI() {
      document.getElementById('username-display').textContent = state.user.username;
      document.getElementById('profile-username').textContent = state.user.username;
      document.getElementById('profile-bio-text').innerHTML = state.user.bio.replace(/\n/g, '<br>') +
        `<br>${state.user.photoCount} photo${state.user.photoCount !== 1 ? "s" : ""}`;
      document.getElementById('profile-img').style.backgroundImage = `url('${state.user.profileImg}')`;
    }
    updateUserUI();

    // Render photo library grid
    const photoLibraryGrid = document.querySelector('.photo-library-grid');

    function renderPhotoLibrary() {
      photoLibraryGrid.innerHTML = '';
      state.photos.forEach(photo => {
        const div = document.createElement('div');
        div.classList.add('photo-card');
        if (photo.id % 2 === 0) div.classList.add('even');
        div.dataset.photoId = photo.id;
        div.tabIndex = 0;
        div.setAttribute('role', 'button');
        div.setAttribute('aria-label', `Photo ${photo.id}`);

        const img = document.createElement('img');
        img.src = photo.src;
        img.alt = `Photo ${photo.id}`;
        div.appendChild(img);

        // Open modal on click or enter key press
        div.addEventListener('click', () => openPostModal(photo.id));
        div.addEventListener('keydown', e => {
          if (e.key === 'Enter' || e.key === " ") {
            e.preventDefault();
            openPostModal(photo.id);
          }
        });

        photoLibraryGrid.appendChild(div);
      });
    }

    renderPhotoLibrary();

    // ===============================
    // Favorites grid
    // ===============================
    const favoritesGrid = document.querySelector('.favorites-grid');
    function renderFavorites() {
      favoritesGrid.innerHTML = '';
      const favorites = state.photos.filter(p => p.favorite);
      if (favorites.length === 0) {
        const noFav = document.createElement('p');
        noFav.className = 'no-favorites-msg';
        noFav.textContent = 'No favorites yet.';
        favoritesGrid.appendChild(noFav);
        return;
      }
      favorites.forEach(photo => {
        const div = document.createElement('div');
        div.className = 'favorite-photo-card';
        div.dataset.photoId = photo.id;
        div.setAttribute('tabindex', '0');
        div.setAttribute('role', 'button');
        div.setAttribute('aria-label', `Favorite photo ${photo.id}`);
        const img = document.createElement('img');
        img.src = photo.src;
        img.alt = `Favorite photo ${photo.id}`;
        div.appendChild(img);
        favoritesGrid.appendChild(div);
        div.addEventListener('click', () => openPostModal(photo.id));
        div.addEventListener('keydown', e => {
          if (e.key === 'Enter') openPostModal(photo.id);
        });
      });
    }
    renderFavorites();

    // ===============================
    // Activity log
    // ===============================
    const activityContainer = document.querySelector('.activity-container');
    function addActivity(desc) {
      const now = new Date();
      const timestamp = now.toLocaleString();
      state.activities.unshift({ desc, timestamp });
      if (state.activities.length > 50) state.activities.length = 50;
      renderActivity();
    }

    function renderActivity() {
      activityContainer.innerHTML = '';
      if (state.activities.length === 0) {
        const emptyDiv = document.createElement('div');
        emptyDiv.className = 'activity-post empty';
        emptyDiv.textContent = 'No activity yet.';
        activityContainer.appendChild(emptyDiv);
        return;
      }
      state.activities.forEach(act => {
        const post = document.createElement('div');
        post.className = 'activity-post';
        post.textContent = `${act.desc}\n${act.timestamp}`;
        activityContainer.appendChild(post);
      });
    }
    renderActivity();

    // Sidebar navigation
    const sidebarButtons = document.querySelectorAll('.left-buttons button');
    sidebarButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        if (btn.dataset.target === 'logout') {
          alert('Logging out...');
          return;
        }
        
        // Hide all sections
        document.querySelectorAll('.section').forEach(section => {
          section.style.display = 'none';
        });
        
        // Show the selected section
        if (btn.dataset.target === 'favorites') {
          document.getElementById('section-favorites').style.display = 'block';
          renderFavorites();
        } else if (btn.dataset.target === 'activity') {
          document.getElementById('section-activity').style.display = 'block';
          renderActivity();
        } else {
          // Default to photo library
          document.getElementById('tab-photolib').style.display = 'block';
        }
        
        // Update active button
        sidebarButtons.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
      });
    });

    // Modal elements
    const postModal = document.getElementById('post-modal');
    const modalLeft = postModal.querySelector('.modal-left');
    const modalUsername = document.getElementById('modal-username');
    const commentsContainer = document.getElementById('comments-container');
    const noCommentsText = document.getElementById('no-comments-text');
    const commentForm = document.getElementById('comment-form');
    const commentInput = document.getElementById('comment-input');
    const commentPostBtn = document.getElementById('comment-post-btn');
    const reactionFooter = document.getElementById('reaction-footer');
    const modalCloseBtn = document.getElementById('post-modal-close-btn');

    let currentPhotoId = null;

    // Modal and form elements for edit profile
    const editProfileModal = document.getElementById('edit-profile-modal');
    const editProfileBtn = document.getElementById('btn-edit-profile');
    const editCloseBtn = document.getElementById('edit-profile-close');
    const editCancelBtn = document.getElementById('edit-cancel-btn');
    const editProfileForm = document.getElementById('edit-profile-form');
    const editUsernameInput = document.getElementById('edit-username');
    const editBioInput = document.getElementById('edit-bio');
    const editProfilePic = document.getElementById('edit-profile-pic');
    const changePhotoBtn = document.getElementById('change-photo-btn');
    const profilePhotoInput = document.getElementById('profile-photo-input');
    const profileMainImg = document.getElementById('profile-img');

    // Function to open edit profile modal and fill current state values
    function openEditProfileModal() {
      editUsernameInput.value = state.user.username;
      editBioInput.value = state.user.bio;
      editProfilePic.src = state.user.profileImg || 'https://via.placeholder.com/100';
      editProfileModal.classList.add('active');
      editUsernameInput.focus();
      trapFocus(editProfileModal);
    }

    // Close modal function for edit profile
    function closeEditProfileModal() {
      editProfileModal.classList.remove('active');
      releaseFocusTrap();
    }

    // Open modal on Edit Profile button click
    editProfileBtn.addEventListener('click', openEditProfileModal);

    // Close modal on close button or cancel button click
    editCloseBtn.addEventListener('click', closeEditProfileModal);
    editCancelBtn.addEventListener('click', closeEditProfileModal);

    // Close modal on clicking outside modal content
    editProfileModal.addEventListener('click', (e) => {
      if (e.target === editProfileModal) closeEditProfileModal();
    });

    // Close modal on ESC key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        if (editProfileModal.classList.contains('active')) {
          closeEditProfileModal();
        }
        if (postModal.classList.contains('active')) {
          postModal.classList.remove('active');
          releaseFocusTrap();
        }
      }
    });

    // Handle Change Photo button - opens actual file explorer
    changePhotoBtn.addEventListener('click', () => {
      profilePhotoInput.click();
    });

    // Handle file selection from file explorer
    profilePhotoInput.addEventListener('change', () => {
      if (profilePhotoInput.files && profilePhotoInput.files[0]) {
        const file = profilePhotoInput.files[0];
        
        // Check if file is an image
        if (!file.type.startsWith('image/')) {
          alert('Please select a valid image file (JPEG, PNG, GIF, etc.).');
          return;
        }
        
        // Create a FileReader to read the file
        const reader = new FileReader();
        
        reader.onload = function(e) {
          // Update the profile picture with the selected image
          const newProfilePic = e.target.result;
          editProfilePic.src = newProfilePic;
          profileMainImg.style.backgroundImage = `url('${newProfilePic}')`;
          state.user.profileImg = newProfilePic;
        };
        
        reader.onerror = function() {
          alert('Error reading the selected file. Please try again.');
        };
        
        // Read the file as a data URL
        reader.readAsDataURL(file);
      }
    });

    // Handle edit profile form submission
    editProfileForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const newUsername = editUsernameInput.value.trim();
      const newBio = editBioInput.value.trim();
      if (newUsername.length === 0) {
        alert('Username cannot be empty.');
        editUsernameInput.focus();
        return;
      }
      // Update state and UI
      state.user.username = newUsername;
      state.user.bio = newBio;
      updateUserUI();
      closeEditProfileModal();
    });

    // Open modal with only the selected photo in the left section
    function openPostModal(photoId) {
      currentPhotoId = photoId;
      const photo = state.photos.find(p => p.id === photoId);
      if (!photo) return;

      modalUsername.textContent = state.user.username;

      // Show only the selected photo in the left section
      modalLeft.style.display = 'flex';
      modalLeft.innerHTML = '';
      
      const img = document.createElement('img');
      img.src = photo.src;
      img.alt = `Photo ${photo.id}`;
      modalLeft.appendChild(img);

      // Render comments & reactions for current photo
      renderComments(photo);
      renderReactions(photo);

      noCommentsText.style.display = photo.comments.length === 0 ? 'block' : 'none';

      postModal.classList.add('active');
      commentInput.value = '';
      commentPostBtn.disabled = true;
      commentInput.focus();

      trapFocus(postModal);
    }

    // Close modal handlers
    modalCloseBtn.addEventListener('click', () => {
      postModal.classList.remove('active');
      releaseFocusTrap();
    });

    postModal.addEventListener('click', e => {
      if (e.target === postModal) {
        postModal.classList.remove('active');
        releaseFocusTrap();
      }
    });

    // Render comments for current photo
    function renderComments(photo) {
      commentsContainer.innerHTML = '';
      if (!photo.comments || photo.comments.length === 0) {
        noCommentsText.style.display = 'block';
        return;
      }
      noCommentsText.style.display = 'none';
      photo.comments.forEach(comment => {
        commentsContainer.appendChild(createCommentElement(comment));
      });
    }

    // Create individual comment element
    function createCommentElement(comment) {
      const div = document.createElement('div');
      div.className = 'comment';
      div.tabIndex = 0;

      const avatar = document.createElement('div');
      avatar.className = 'avatar';
      avatar.style.backgroundImage = `url('${comment.avatar || 'https://via.placeholder.com/40x40.png?text='}')`;
      div.appendChild(avatar);

      const content = document.createElement('div');
      content.className = 'comment-content';

      const author = document.createElement('div');
      author.className = 'comment-author';
      author.textContent = comment.username;
      content.appendChild(author);

      const text = document.createElement('div');
      text.className = 'comment-text';
      text.textContent = comment.text;
      content.appendChild(text);

      const footer = document.createElement('div');
      footer.className = 'comment-footer';

      const dateSpan = document.createElement('span');
      dateSpan.textContent = comment.date || 'now';
      footer.appendChild(dateSpan);

      const replyBtn = document.createElement('button');
      replyBtn.textContent = 'Reply';
      replyBtn.setAttribute('aria-label', 'Reply to ' + comment.username);
      footer.appendChild(replyBtn);

      // Like heart icon as image
      const heartImg = document.createElement('img');
      heartImg.classList.add('heart-icon');
      heartImg.src = 'Icons 2/heart.svg';
      heartImg.alt = 'Like comment';
      heartImg.title = 'Like comment';
      footer.appendChild(heartImg);

      div.appendChild(content);
      div.appendChild(footer);

      replyBtn.addEventListener('click', () => {
        commentInput.value = `@${comment.username} `;
        commentInput.focus();
      });
      heartImg.addEventListener('click', () => {
        heartImg.classList.toggle('liked');
      });

      return div;
    }

    // Render reactions (like, favorite, comment button, likes count)
    function renderReactions(photo) {
      reactionFooter.innerHTML = '';

      // Heart like button as image
      const heartBtn = document.createElement('img');
      heartBtn.classList.add('heart-icon');
      heartBtn.src = 'Icons 2/heart.svg';
      heartBtn.alt = 'Like photo';
      heartBtn.title = 'Like photo';
      if (photo.liked) heartBtn.classList.add('liked');
      reactionFooter.appendChild(heartBtn);

      // Comment icon as image
      const commentBtn = document.createElement('img');
      commentBtn.classList.add('comment-icon');
      commentBtn.src = 'Icons 2/comment.svg';
      commentBtn.alt = 'Add comment';
      commentBtn.title = 'Add comment';
      commentBtn.style.marginLeft = '12px';
      commentBtn.style.cursor = 'pointer';
      reactionFooter.appendChild(commentBtn);

      // Likes count or placeholder text
      const likesText = document.createElement('div');
      likesText.className = 'likes-text';
      const count = photo.liked ? Math.floor(Math.random() * 10) + 1 : 0;
      likesText.textContent = count > 0 ? `${count} people liked this` : 'Be the first to like this';
      reactionFooter.appendChild(likesText);

      // Date text
      const dateText = document.createElement('div');
      dateText.style.color = '#edb9d5';
      dateText.style.fontSize = '11px';
      dateText.textContent = photo.date || new Date().toLocaleDateString();
      reactionFooter.appendChild(dateText);

      // Bookmark (favorite) icon as image
      const bookmark = document.createElement('img');
      bookmark.classList.add('bookmark-icon');
      bookmark.src = 'Icons 2/save.svg';
      bookmark.alt = photo.favorite ? 'Remove from favorites' : 'Add to favorites';
      bookmark.title = photo.favorite ? 'Remove from favorites' : 'Add to favorites';
      if (photo.favorite) bookmark.classList.add('active');
      bookmark.style.marginLeft = 'auto';
      bookmark.style.cursor = 'pointer';
      reactionFooter.appendChild(bookmark);

      // Toggle favorite on bookmark click
      bookmark.addEventListener('click', () => {
        photo.favorite = !photo.favorite;
        bookmark.classList.toggle('active');
        bookmark.alt = photo.favorite ? 'Remove from favorites' : 'Add to favorites';
        bookmark.title = photo.favorite ? 'Remove from favorites' : 'Add to favorites';
        renderFavorites();
        addActivity(`Photo ${photo.id} ${photo.favorite ? 'added to' : 'removed from'} favorites`);
      });

      // Toggle like photo on heart click and update reaction area
      heartBtn.addEventListener('click', () => {
        photo.liked = !photo.liked;
        heartBtn.classList.toggle('liked');
        renderReactions(photo);
        addActivity(`Photo ${photo.id} ${photo.liked ? 'liked' : 'unliked'}`);
      });

      // Focus comment textarea on comment icon click
      commentBtn.addEventListener('click', () => commentInput.focus());
    }

    // Comment input enable/disable Post button
    commentInput.addEventListener('input', () => {
      commentPostBtn.disabled = commentInput.value.trim().length === 0;
    });

    // Handle comment submit
    commentForm.addEventListener('submit', e => {
      e.preventDefault();
      if (currentPhotoId === null) return;
      const photo = state.photos.find(p => p.id === currentPhotoId);
      if (photo && commentInput.value.trim() !== '') {
        if (!Array.isArray(photo.comments)) photo.comments = [];
        photo.comments.push({
          username: state.user.username,
          avatar: state.user.profileImg,
          text: commentInput.value.trim(),
          date: new Date().toLocaleDateString()
        });
        commentInput.value = '';
        commentPostBtn.disabled = true;
        renderComments(photo);
        noCommentsText.style.display = 'none';
        addActivity(`New comment on photo ${photo.id}`);
      }
    });

    // Accessibility: Trap focus inside modal when open
    let lastFocusedElement = null;

    function trapFocus(element) {
      lastFocusedElement = document.activeElement;
      const focusableElements = element.querySelectorAll(
        'a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), iframe, object, embed, [tabindex="0"], [contenteditable]'
      );
      const firstFocusable = focusableElements[0];
      const lastFocusable = focusableElements[focusableElements.length - 1];

      function handleKeyDown(e) {
        if (e.key === 'Tab') {
          if (e.shiftKey) {
            if (document.activeElement === firstFocusable) {
              e.preventDefault();
              lastFocusable.focus();
            }
          } else {
            if (document.activeElement === lastFocusable) {
              e.preventDefault();
              firstFocusable.focus();
            }
          }
        }
      }

      element.addEventListener('keydown', handleKeyDown);
      element._focusTrapHandler = handleKeyDown;

      firstFocusable.focus();
    }

    function releaseFocusTrap() {
      if (lastFocusedElement) lastFocusedElement.focus();
      // Remove event listener for postModal
      if (postModal._focusTrapHandler) {
        postModal.removeEventListener('keydown', postModal._focusTrapHandler);
        postModal._focusTrapHandler = null;
      }
      // Remove event listener for editProfileModal
      if (editProfileModal._focusTrapHandler) {
        editProfileModal.removeEventListener('keydown', editProfileModal._focusTrapHandler);
        editProfileModal._focusTrapHandler = null;
      }
    }

    // Add some sample activities
    addActivity('Profile picture updated');
    addActivity('Photo 1 added to favorites');
    addActivity('New comment on photo 2');
  </script>
</body>

</html>